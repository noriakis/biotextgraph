---
title: "Mining microbiome-related literature"
author: "Noriaki Sato"
package: wcGeneSummary
output: 
    BiocStyle::html_document:
    toc_float: true
vignette: >
    %\VignetteIndexEntry{wcGeneSummary}
    %\VignetteEngine{knitr::knitr}
    %\VignetteEncoding{UTF-8}  
---
    
The general usage for mining the information related to microbiome-related signatures.

```{r load, warning=FALSE, message=FALSE}
library(wcGeneSummary)
library(ggplot2)
library(ggraph)
library(RColorBrewer)
```

We use BugSigDB, and its R port bugsigdbr to obtain the curated dataset of the relationship with bacterial taxonomy and human diseases ([Geistlinger et al. 2022](https://bugsigdb.org/Main_Page)). Users can query microbiome names, which will be searched for MetaPhlAn taxonomic annotation. If `target="title"`, the title of the corresponding articles will be summarized.

```{r bsdb_basic, warning=FALSE, message=FALSE, fig.height=8, fig.width=8, cache=TRUE}
basic <- wcBSDB(c("Veillonella dispar","Neisseria flava"),tag=FALSE,
    curate=TRUE,target="title",pre=TRUE,cl=snow::makeCluster(12),
    pal=RColorBrewer::brewer.pal(10, "Set2"),numWords=80,min.freq=1)
basic@freqDf |> head()
basic@wc
```
If `target="abstract"`, the corresponding abstract will be fetched and be summarized.

```{r bsdb_basic2, warning=FALSE, message=FALSE, fig.height=8, fig.width=8, cache=TRUE}
basic2 <- wcBSDB(c("Veillonella dispar","Neisseria flava"),tag=TRUE,
    curate=TRUE,target="abstract",pre=TRUE,cl=snow::makeCluster(12),
    pal=RColorBrewer::brewer.pal(10, "Set2"),numWords=80)
basic2@freqDf |> head()
basic2@wc
```
For successful visualization, pre-caculated TF-IDF and frequency data frame is available and one can use them to filter the highly occurring words, or the other prefiltering option used in `wcGeneSummary`.

```{r filters, warning=FALSE, message=FALSE, cache=TRUE}
rmwords <- wcGeneSummary:::allTfIdfBSDB
filter <- rmwords[rmwords$tfidf>quantile(rmwords$tfidf, 0.95),]
filter |> head()
```
The network visualization is possible by enabling `plotType="network"`.

```{r bsdb_basic_network, warning=FALSE, message=FALSE, fig.height=8, fig.width=8, cache=TRUE}
net <- wcBSDB(c("Veillonella dispar","Neisseria flava"),
    curate=TRUE,target="title",pre=TRUE,plotType="network",
    additionalRemove=filter$word, corThresh=0.2,
    numWords=40)
net@net
```

The words-to-species relationship can be plotted by `mbPlot=TRUE`.

```{r bsdb_basic_network_mb, warning=FALSE, message=FALSE, fig.height=8, fig.width=8, cache=TRUE}
net2 <- wcBSDB(c("Veillonella dispar","Neisseria flava",
    "Veillonella parvula","Akkermansia muciniphila"), mbPlot=TRUE,
    curate=TRUE,target="title",pre=TRUE,plotType="network",
    additionalRemove=filter$word,
    numWords=40, corThresh=0.2, colorText=TRUE)
net2@net
```

As the BugSigDB contains the relationship between bacterial taxonomy and disease, disease name can also be plotted. When `disPlot=TRUE`, the `mbPlot`
 will be set to `TRUE` by default.
 
```{r bsdb_basic_network_dis, warning=FALSE, message=FALSE, fig.height=10, fig.width=10, cache=TRUE}
net3 <- wcBSDB(c("Veillonella dispar","Neisseria flava",
    "Veillonella parvula","Akkermansia muciniphila"), mbPlot=TRUE,
    curate=TRUE,target="title",pre=TRUE,plotType="network",
    additionalRemove=filter$word, disPlot=TRUE,
    numWords=40, corThresh=0.2, colorText=TRUE)
net3@net
```

Other than curated databases, the PubMed query can also be performed with setting `curate=FALSE`. This way, the text information of the latest literature for the microbes and diseases can be plotted. The options for use in function obtaining PubMed information can be specified to `abstArg` in list format.

```{r no_curate, warning=FALSE, message=FALSE, fig.height=10, fig.width=10, cache=TRUE}
net4 <- wcBSDB(c("Veillonella dispar","Neisseria flava",
    "Veillonella parvula","Akkermansia muciniphila"), mbPlot=TRUE,
    curate=FALSE,target="title",pre=TRUE,plotType="network",
    additionalRemove=filter$word, disPlot=TRUE,
    numWords=40, corThresh=0.2, colorText=TRUE,
    abstArg = list(retMax=80, sortOrder="pubdate"))
net4@net
```

For microbiome analysis, it is often the case that investigating coded enzymes is important. Using `wcEC` function and `getUPtax` function, the queried species or genus can be linked to possible interaction with enzymes using following databases. The downloaded file path should be specified to the function like below to link the queried taxonomy and enzymes. Specifically, enzymes listed in `enzyme.dat` are searched, and corresponding UniProt identifiers are obtained, followed by mapping using `speclist.txt`. This way, the links to microbe - textual information - enzyme can be plotted. 

- [enzyme.dat from Expasy](https://enzyme.expasy.org/)
- [UniProt Controlled vocabulary of species](https://ftp.uniprot.org/pub/databases/uniprot/current_release/knowledgebase/complete/docs/speclist.txt)

```{r enzyme, warning=FALSE, message=FALSE, fig.height=10, fig.width=10, cache=TRUE}
## Not run
vp <- wcBSDB(c("Veillonella parvula"),
                 plotType="network",
                curate=TRUE, target="title", edgeLink=FALSE,
                mbPlot = TRUE, ecPlot=TRUE, disPlot=TRUE, tag=TRUE,
                cl=snow::makeCluster(10),colorText=TRUE, pre=TRUE, numWords=30,
                nodePal=RColorBrewer::brewer.pal(10, "Set2"),
                ecFile="enzyme.dat",
                upTaxFile = "speclist.txt")
```{r}
sessionInfo()
```